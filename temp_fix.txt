        # === 2. ç¾åŒ–æŠ¥å‘Š UI (Styled Report Card) ===
        # Fix: Calculate formatted string outside f-string to avoid backslash error
        formatted_analysis = llm_analysis.replace('\n', '<br>')
        
        # åŠ¨æ€ç”Ÿæˆæ¨¡å‹å¯¹æ¯”æ¡ (HTML/CSS)
        # æ”¾å¤§å·®å¼‚ä»¥ä¾¿æ˜¾ç¤ºï¼Œä½†é™åˆ¶åœ¨åˆç†èŒƒå›´å†…
        diff_width = min(100, abs(pred_stacking - pred_lstm) / (final_pred + 1e-6) * 100 * 5) 
        
        report_html = f"""
<div style="background-color: #1E2530; border-left: 5px solid #00ADB5; padding: 20px; border-radius: 5px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); font-family: 'Segoe UI', sans-serif; color: #E0E0E0;">
<div style="display: flex; align-items: center; margin-bottom: 10px;">
<span style="font-size: 20px; margin-right: 10px;">ğŸ©º</span>
<h4 style="margin: 0; color: #00ADB5;">æ¨¡å‹ä¼šè¯Š (Multi-Model Consensus)</h4>
</div>
<!-- New: Visual Model Comparison -->
<div style="background: #2D333B; padding: 8px; border-radius: 4px; margin-bottom: 15px; font-size: 12px;">
<div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
<span>ğŸ“š Stacking: <b>{pred_stacking:.2f}</b></span>
<span>ğŸ§  BiLSTM: <b>{pred_lstm:.2f}</b></span>
</div>
<div style="height: 6px; background: #444; border-radius: 3px; position: relative;">
<div style="position: absolute; left: 0; top: 0; height: 100%; width: 50%; background: #00ADB5; opacity: 0.6; border-radius: 3px 0 0 3px;"></div>
<div style="position: absolute; right: 0; top: 0; height: 100%; width: 50%; background: #A020F0; opacity: 0.6; border-radius: 0 3px 3px 0;"></div>
<div style="position: absolute; left: 50%; top: -2px; height: 10px; width: 2px; background: #FFF;"></div>
<!-- å·®å¼‚æŒ‡ç¤ºå™?-->
<div style="position: absolute; top: 0; height: 100%; left: {50 - diff_width/2}%; width: {diff_width}%; background: rgba(255, 255, 0, 0.4);"></div>
</div>
<div style="text-align: center; color: #888; margin-top: 2px;">Stacking (Left) vs LSTM (Right)</div>
</div>
<div style="font-size: 13px; line-height: 1.6; opacity: 0.9;">
{formatted_analysis}
</div>
</div>
"""
        st.markdown(report_html, unsafe_allow_html=True)
